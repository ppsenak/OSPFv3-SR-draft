<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std"
     docName="draft-psenak-ospf-segment-routing-ospfv3-extension-02"
     ipr="trust200902">
  <front>
    <title abbrev="OSPFv3 Extensions for Segment Routing">OSPFv3 Extensions
    for Segment Routing</title>

    <author fullname="Peter Psenak" initials="P." role="editor"
            surname="Psenak">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>Apollo Business Center</street>

          <street>Mlynske nivy 43</street>

          <city>Bratislava</city>

          <code>821 09</code>

          <country>Slovakia</country>
        </postal>

        <email>ppsenak@cisco.com</email>
      </address>
    </author>

    <author fullname="Stefano Previdi" initials="S." role="editor"
            surname="Previdi">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>Via Del Serafico, 200</street>

          <city>Rome</city>

          <code>00142</code>

          <country>Italy</country>
        </postal>

        <email>sprevidi@cisco.com</email>
      </address>
    </author>

    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street/>

          <city>Brussels</city>

          <region/>

          <code/>

          <country>Belgium</country>
        </postal>

        <email>cfilsfil@cisco.com</email>
      </address>
    </author>

    <author fullname="Hannes Gredler" initials="H." surname="Gredler">
      <organization>Juniper Networks, Inc.</organization>

      <address>
        <postal>
          <street>1194 N. Mathilda Ave.</street>

          <city>Sunnyvale</city>

          <code>94089</code>

          <region>CA</region>

          <country>US</country>
        </postal>

        <email>hannes@juniper.net</email>
      </address>
    </author>

    <author fullname="Rob Shakir" initials="R." surname="Shakir">
      <organization>British Telecom</organization>

      <address>
        <postal>
          <street/>

          <city>London</city>

          <code/>

          <country>UK</country>
        </postal>

        <email>rob.shakir@bt.com</email>
      </address>
    </author>

    <author fullname="Wim Henderickx" initials="W." surname="Henderickx">
      <organization>Alcatel-Lucent</organization>

      <address>
        <postal>
          <street>Copernicuslaan 50</street>

          <city>Antwerp</city>

          <code>2018</code>

          <country>BE</country>
        </postal>

        <email>wim.henderickx@alcatel-lucent.com</email>
      </address>
    </author>
    
    <author fullname="Jeff Tantsura" initials="J." surname="Tantsura">
      <organization>Ericsson</organization>

      <address>
        <postal>
          <street>300 Holger Way</street>

          <city>San Jose</city>

          <region>CA</region>

          <code>95134</code>

          <country>US</country>
        </postal>

        <email>Jeff.Tantsura@ericsson.com</email>
      </address>
    </author>

    <date day="25" month="June" year="2014"/>

    <area>Routing</area>

    <workgroup>Open Shortest Path First IGP</workgroup>

    <keyword>MPLS</keyword>

    <keyword>SID</keyword>

    <keyword>IGP</keyword>

    <keyword>OSPF</keyword>

    <keyword>Label advertisement</keyword>

    <keyword>Segment Routing</keyword>

    <abstract>
      <t>Segment Routing (SR) allows for a flexible definition of end-to-end
      paths within IGP topologies by encoding paths as sequences of
      topological sub-paths, called "segments". These segments are advertised
      by the link-state routing protocols (IS-IS and OSPF).</t>

      <t>This draft describes the necessary OSPFv3 extensions that need to be
      introduced for Segment Routing.</t>
    </abstract>

    <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref>.</t>
    </note>
  </front>

  <middle>
    <section title="Introduction">
      <t>Segment Routing (SR) allows for a flexible definition of end-to-end
      paths within IGP topologies by encoding paths as sequences of
      topological sub-paths, called "segments". These segments are advertised
      by the link-state routing protocols (IS-IS and OSPF). Prefix segments
      represent an ecmp-aware shortest-path to a prefix (or a node), as per
      the state of the IGP topology. Adjacency segments represent a hop over a
      specific adjacency between two nodes in the IGP. A prefix segment is
      typically a multi-hop path while an adjacency segment, in most of the
      cases, is a one-hop path. SR's control-plane can be applied to both IPv6
      and MPLS data-planes, and do not require any additional signaling (other
      than the regular IGP). For example, when used in MPLS networks, SR paths
      do not require any LDP or RSVP-TE signaling. Still, SR can interoperate
      in the presence of LSPs established with RSVP or LDP .</t>

      <t>This draft describes the necessary OSPFv3 extensions that need to be
      introduced for Segment Routing.</t>

      <t>Segment Routing architecture is described in <xref
      target="I-D.filsfils-rtgwg-segment-routing"/>.</t>

      <t>Segment Routing use cases are described in <xref
      target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>.</t>
    </section>

    <section title="Segment Routing Identifiers">
      <t>Segment Routing defines various types of Segment Identifiers (SIDs):
      Prefix-SID, Adjacency-SID, LAN Adjacency SID and Binding SID.</t>

      <section anchor="SIDLABEL" title="SID/Label sub-TLV">
        <t>SID/Label sub-TLV appears in multiple TLVs or Sub-TLVs defined
        later in this document. It is used to advertise SID or label
        associated with the prefix or adjacency. SID/Label TLV has following
        format:<figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type            |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      SID/Label (variable)                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:
</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 1</t>

            <t>Length: variable, 3 or 4 bytes</t>

            <t>SID/Label: if length is set to 3, then the 20 rightmost bits
            represent a label. If length is set to 4 then the value represents
            a 32 bit SID.</t>

            <t>The receiving router MUST ignore SID/Label sub-TLV if the length 
            is other then 3 or 4.</t>
            
          </list></t>
      </section>
    </section>

    <section anchor="SRCAP" title="Segment Routing Capabilities">
      <t>Segment Routing requires some additional capabilities of the router
      to be advertised to other routers in the area.</t>

      <t>These SR capabilities are advertised in OSPFv3 Router Information
      Opaque LSA (defined in <xref target="RFC4970"/>).</t>

      <section anchor="SRALGO" title="SR-Algorithm TLV">
        <t>SR-Algorithm TLV is a TLV of Router Information Opaque LSA (defined
        in <xref target="RFC4970"/>).</t>

        <t>Router may use various algorithms when calculating reachability to
        other nodes in area or to prefixes attached to these nodes. Examples
        of these algorithms are metric based Shortest Path First (SPF),
        various sorts of Constrained SPF, etc. SR-Algorithm TLV allows a
        router to advertise algorithms that router is currently using to other
        routers in an area. SR-Algorithm TLV has following structure: <figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Type               |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Algorithm 1  |  Algorithm... |  Algorithm n |                |
+-                                                             -+
|                                                               |
+                                                               +

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 8</t>

            <t>Length: variable</t>

            <t>Algorithm: one octet identifying the algorithm. The following
            value has been defined:<list style="hanging">
                <t>0: IGP metric based SPT.</t>
              </list></t>
          </list></t>

        <t>RI LSA can be advertised at any of the defined flooding scopes
        (link, area, or autonomous system (AS)). For the purpose of the
        SR-Algorithm TLV propagation area scope flooding is required.</t>
      </section>

      <section anchor="SIDRANGE" title="SID/Label Range TLV">
        <t>The SID/Label Range TLV is a TLV of Router Information Opaque LSA
        (defined in <xref target="RFC4970"/>).</t>

        <t>SID/Label Sub-TLV MAY appear multiple times and has following
        format:<figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type          |               Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Range Size               |   Reserved    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Sub-TLVs (variable)                       |
+-                                                             -+
|                                                               |
+                                                               +

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 9</t>

            <t>Length: variable</t>

            <t>Range Size: 3 octets of SID/label range</t>
          </list></t>

        <t>Currently the only supported Sub-TLV is the SID/Label TLV as
        defined in <xref target="SIDLABEL"/>. SID/Label advertised in
        SID/Label TLV represents the first SID/Label from the advertised
        range.</t>
        
        <t>Multiple occurrence of the SID/Label Range TLV MAY be
        advertised, in order to advertise multiple ranges. In such case:<list
            style="symbols">

            <t>The originating router MUST encode each range into a different SID/Label 
            Range TLV. </t>

            <t>The originating router decides in which order the set of SID/Label Range
            TLVs are advertised inside Router Information Opaque LSA. The originating router
            MUST ensure the order is same after a graceful restart (using checkpointing,
            non-volatile storage or any other mechanism) in order to guarantee the same 
            order before and after graceful restart.</t>
            
            <t>Receiving router must adhere to the order in which the ranges are 
            advertised when calculating a SID/label from the SID index.</t>
            
            <t>A router not supporting multiple occurrences SID/Label Range TLV MUST 
            take into consideration the first occurrence in the received set.</t>
          </list></t>

        <t>Here follows an example of advertisement of multiple ranges:<figure
            suppress-title="true">
            <artwork>
   The originating router advertises following ranges:
      Range 1: [100, 199]
      Range 2: [1000, 1099]
      Range 3: [500, 599]

   The receiving routers concatenate the ranges and build the SRGB
   is as follows:

   SRGB = [100, 199]
          [1000, 1099]
          [500, 599]

   The indexes span multiple ranges:

      index=0 means label 100
      ...
      index 99 means label 199
      index 100 means label 1000
      index 199 means label 1099
      ...
      index 200 means label 500
      ...
</artwork>
          </figure></t>

        <t>RI LSA can be advertised at any of the defined flooding scopes
        (link, area, or autonomous system (AS)). For the purpose of the
        SR-Capability TLV propagation area scope flooding is required.</t>
      </section>
    </section>

    <section anchor="EXTPXLSA" title="Prefix SID Identifier ">
      <t>A new extended OSPFv3 LSAs as defined in <xref
      target="I-D.ietf-ospf-ospfv3-lsa-extend"/> are used to advertise SID or label values 
      associated with the prefix in OSPFv3.</t>

      <section anchor="PREFIXSID" title="Prefix SID Sub-TLV">
        <t>The Prefix SID Sub-TLV is a Sub-TLV of the following OSPFv3 TLVs as
        defined in <xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>: <list
            style="hanging">
            <t>Intra-Area Prefix TLV</t>

            <t>Inter-Area Prefix TLV</t>

            <t>External Prefix TLV</t>
          </list></t>

        <t>It MAY appear more than once and has following format: <figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type            |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Flags       |  Algorithm  |          Range Size           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       SID/Index/Label (variable)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 2.</t>

            <t>Length: variable</t>

            <t>Flags: 1 octet field. The following flags are defined: <figure
                align="center">
                <artwork>
 0      
 0 1 2 3 4 5 6 7 
+-+-+-+-+-+-+-+-+
|N|P|M|E|V|L|   |
+-+-+-+-+-+-+-+-+

where:</artwork>
              </figure><list style="hanging">
                <t>N-Flag: Node-SID flag. If set, then the Prefix-SID refers
                to the router identified by the prefix. Typically, the N-Flag
                is set on Prefix-SIDs attached to a router loopback address.
                The N-Flag is set when the Prefix-SID is a Node- SID as
                described in <xref
                target="I-D.filsfils-rtgwg-segment-routing"/>.</t>

                <t>P-Flag: no-PHP flag. If set, then the penultimate hop MUST
                NOT pop the Prefix-SID before delivering the packet to the
                node that advertised the Prefix-SID.</t>

                <t>M-Flag: Mapping Server Flag. If set, the SID is advertised
                from the Segment Routing Mapping Server functionality as
                described in <xref
                target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>.</t>
                
                <t>E-Flag: Explicit-Null Flag. If set, any upstream neighbor 
                of the Prefix-SID originator MUST replace the Prefix-SID with 
                a Prefix-SID having an Explicit-NULL value (0 for IPv4) before
                forwarding the packet.</t>
                
                <t>The V-Flag: Value/Index Flag. If set, then the Prefix-SID 
                carries an absolute value. If not set, then the Prefix-SID carries 
                an index.</t>
                
                <t>The L-Flag: Local/Global Flag. If set, then the value/index 
                carried by the PrefixSID has local significance. If not set, then
                the value/index carried by this subTLV has global significance.</t> 

                <t>Other bits: MUST be zero when sent and ignored when
                received.</t>
              </list></t>

            <t>Algorithm: one octet identifying the algorithm the Prefix-SID
            is associated with as defined in <xref target="SRALGO"/>.</t>

            <t>Range Size: this field provides the ability to specify a range
            of addresses and their associated Prefix SIDs. It represents a
            compression scheme to distribute a continuous Prefix and their
            continuous, corresponding SID/Label Block. If a single SID is
            advertised then the Range Size field MUST be set to 1. For range
            advertisements &gt; 1, Range Size represents the number of
            addresses that need to be mapped into a Prefix-SID.</t>

            <t>SID/Index/Label: label or index value depending on the V-bit setting.
            <list style="hanging">
            
                <t>Examples: <list style="hanging">
            
                    <t>A 32 bit global index defining the offset in the SID/Label space
                    advertised by this router - in this case the V and L flags MUST be 
                    unset.</t>
             
                    <t>A 24 bit local label where the 20 rightmost bits are used for 
                    encoding the label value - in this case the V and L flags MUST be
                    set.</t>
                </list></t>
            </list></t>
          
     </list></t>
          

        <t>If multiple Prefix-SIDs are advertised for the same prefix, the
        receiving router MUST use the first encoded SID and MAY use the
        subsequent ones.</t>
        
        <t>When propagating Prefix-SIDs between areas, if multiple prefix-SIDs are 
        advertised for a prefix, an implementation SHOULD preserve the original ordering, 
        when advertising prefix-SIDs to other areas. This allows implementations that only
        use single Prefix-SID to have a consistent view across areas.</t>
        
        <t>When calculating the outgoing label for the prefix, the router MUST
        take into account E and P flags advertised by the next-hop router, if
        next-hop router advertised the SID for the prefix.  This MUST be done
        regardless of next-hop router contributing to the best path to the
        prefix or not.</t>

        <t>P-Flag (no-PHP) MUST be set on the Prefix-SIDs allocated to inter-
        area prefixes that are originated by the ABR based on intra-area or
        inter-area reachability between areas. In case the inter-area prefix
        is generated based on the prefix which is directly attached to the
        ABR, P-Flag SHOULD NOT be set</t>

        <t>P-Flag (no-PHP) MUST NOT be set on the Prefix-SIDs allocated to
        redistributed prefixes, unless the redistributed prefix is directly
        attached to ASBR, in which case the P-Flag SHOULD NOT be set.</t>
        
        <t>If the P-flag is not set then any upstream neighbor of the Prefix-SID
        originator MUST pop the Prefix-SID. This is equivalent to the penultimate
        hop popping mechanism used in the MPLS dataplane. In such case MPLS EXP bits
        of the Prefix-SID are not preserved to the ultimate hop (the Prefix-SID
        being removed). If the P-flag is unset the received E-flag is ignored.</t>
        
        <t>If the P-flag is set then:<list style="hanging">
        
        <t> If the E-flag is not set then any upstream neighbor of the Prefix-SID 
        originator MUST keep the Prefix-SID on top of the stack.  This is useful when
        the originator of the Prefix-SID must stitch the incoming packet into a continuing
        MPLS LSP to the final destination. This could occur at an inter-area border router
        (prefix propagation from one area to another) or at an inter-domain border router 
        (prefix propagation from one domain to another).</t>
         
         <t>If the E-flag is set then any upstream neighbor of the Prefix-SID originator 
         MUST replace the PrefixSID with a Prefix-SID having an Explicit-NULL value. This
         is useful, e.g., when the originator of the Prefix-SID is the final destination
         for the related prefix and the originator wishes to receive the packet with the 
         original EXP bits.</t>
         </list></t>

        <t>When M-Flag is set, P-flag MUST be set and E-bit MUST NOT be set.</t>

        <t>Example 1: if the following router addresses (loopback addresses)
        need to be mapped into the corresponding Prefix SID indexes: <figure
            suppress-title="true">
            <artwork>
          Router-A: 192::1/128, Prefix-SID: Index 1
          Router-B: 192::2/128, Prefix-SID: Index 2
          Router-C: 192::3/128, Prefix-SID: Index 3
          Router-D: 192::4/128, Prefix-SID: Index 4
           </artwork>
          </figure></t>

        <t>then the Address Prefix field in Intra-Area Prefix TLV, Inter-Area
        Prefix TLV or External Prefix TLV is set to 192::1, Prefix Length in
        these TLVs would be set to 128, Range Size in Prefix SID sub-TLV would
        be set to 4 and Index value would be set to 1.</t>

        <t>Example 2: If the following prefixes need to be mapped into the
        corresponding Prefix-SID indexes: <figure suppress-title="true">
            <artwork>
          10:1:1::0/120,   Prefix-SID: Index 51
          10:1:1::100/120, Prefix-SID: Index 52
          10:1:1::200/120, Prefix-SID: Index 53
          10:1:1::300/120, Prefix-SID: Index 54
          10:1:1::400/120, Prefix-SID: Index 55
          10:1:1::500/120, Prefix-SID: Index 56
          10:1:1::600/120, Prefix-SID: Index 57
           </artwork>
          </figure></t>

        <t>then the Address Prefix field in Intra-Area Prefix TLV, Inter-Area
        Prefix TLV or External Prefix TLV is set to 10:1:1::0, Prefix Length
        in these TLVs would be set to 120, Range Size in Prefix SID sub-TLV
        would be set to 7 and Index value would be set to 51.</t>
      </section>

      <section anchor="SIDBINDING" title="SID/Label Binding sub-TLV">
        <t>SID/Label Binding sub-TLV is used to advertise SID/Label mapping
        for a path to the prefix. </t>
        
        <t>The SID/Label Binding TLV MAY be originated by any router in an
        OSPFv3 domain. The router may advertise a SID/Label binding to a FEC
        along with at least a single 'nexthop style' anchor. The protocol
        supports more than one 'nexthop style' anchor to be attached to a
        SID/Label binding, which results into a simple path description
        language. In analogy to RSVP the terminology for this is called an
        'Explicit Route Object' (ERO). Since ERO style path notation allows to
        anchor SID/label bindings to both link and node IP addresses any
        label switched path, can be described. Furthermore also SID/Label
        Bindings from external protocols can get easily re-advertised.</t>

        <t>The SID/Label Binding TLV may be used for advertising SID/Label
        Bindings and their associated Primary and Backup paths. In one single
        TLV either a primary ERO Path, a backup ERO Path or both are
        advertised. If a router wants to advertise multiple parallel paths
        then it can generate several TLVs for the same Prefix/FEC. Each
        occurrence of a Binding TLV with respect with a given FEC Prefix has
        accumulating and not canceling semantics.</t>
        
        <t>SID/Label Binding sub-TLV is a sub-TLV of the following OSPFv3
        TLVs, as defined in <xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>: <list
            style="hanging">
            <t>Intra-Area Prefix TLV</t>

            <t>Inter-Area Prefix TLV</t>

            <t>External Prefix TLV</t>
          </list></t>

        <t>Multiple SID/Label Binding sub-TLVs can be present in above
        mentioned TLVs. SID/Label Binding sub-TLV has following format: <figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Type             |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Flags       |   Weight    |           Range Size          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Sub-TLVs (variable)                     |
+-                                                             -+
|                                                               |

where: </artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 5</t>

            <t>Length: variable</t>

            <t>Flags: 1 octet field of following flags:<figure align="center">
                <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|M|             |
+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>M-bit - When the bit is set the binding represents the
                mirroring context as defined in <xref
                target="I-D.minto-rsvp-lsp-egress-fast-protection"/>.</t>
              </list></t>

            <t>Weight: weight used for load-balancing purposes. The use of the
            weight is defined in <xref
            target="I-D.filsfils-rtgwg-segment-routing"/>.</t>

            <t>Range Size: usage is the same as described in <xref
            target="PREFIXSID"/></t>
          </list></t>

        <t>SID/Label Binding sub-TLV currently supports following
        Sub-TLVs:<list style="hanging">
            <t>SID/Label sub-TLV as described in <xref target="SIDLABEL"/>.
            This sub-TLV MUST appear in the SID/Label Binding Sub-TLV and it
            MUST only appear once.</t>

            <t>ERO Metric sub-TLV as defined in <xref
            target="METRICTLV"/>.</t>

            <t>ERO sub-TLVs as defined in <xref target="EROTLV"/>.</t>
          </list></t>

        <!-- begin Metric subTLV -->

        <section anchor="METRICTLV" title="ERO Metric sub-TLV">
          <t>ERO Metric sub-TLV is a Sub-TLV of the SID/Label Binding TLV.</t>

          <t>The ERO Metric sub-TLV carries the cost of an ERO path. It is
          used to compare the cost of a given source/destination path. A
          router SHOULD advertise the ERO Metric sub-TLV. The cost of the ERO
          Metric sub-TLV SHOULD be set to the cumulative IGP or TE path cost
          of the advertised ERO. Since manipulation of the Metric field may
          attract or distract traffic from and to the advertised segment it
          MAY be manually overridden. <figure
              title="ERO Metric sub-TLV format">
              <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Type             |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Metric (4 octets)                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </artwork>
            </figure> where: <list style="hanging">
              <t>Type: TBD, suggested value 6</t>

              <t>Length: 4 bytes</t>

              <t>Metric: 4 bytes</t>
            </list></t>
        </section>

        <!-- end metric subTLV -->

        <section anchor="EROTLV" title="ERO sub-TLVs">
          <t>All 'ERO' information represents an ordered set which describes
          the segments of a path. The last ERO sub-TLV describes the segment
          closest to the egress point, contrary the first ERO sub-TLV
          describes the first segment of a path. If a router extends or
          stitches a path it MUST prepend the new segments path information to
          the ERO list.</t>

          <t>The above similarly applies to backup EROs.</t>

          <t>All ERO Sub-TLVs must immediately follow the (SID)/Label
          Sub-TLV.</t>

          <t>All Backup ERO sub-TLVs must immediately follow last ERO
          Sub-TLV.</t>

          <section anchor="IPV4ERO" title="IPv4 ERO sub-TLV">
            <t>IPv4 ERO sub-TLV is a sub-TLV of the SID/Label Binding
            sub-TLV.</t>

            <t>The IPv4 ERO sub-TLV describes a path segment using IPv4
            Address style of encoding. Its semantics have been borrowed from
            <xref target="RFC3209"/>. <figure title="IPv4 ERO sub-TLV format">
                <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type            |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Flags      |                   Reserved                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        IPv4 Address (4 octets)                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>Type: TBD, suggested value 7</t>

                <t>Length: 8 bytes</t>

                <t>Flags: 1 octet field of following flags: <figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+
</artwork>
                  </figure> where: <list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>IPv4 Address - the address of the explicit route hop.</t>
              </list></t>
          </section>

          <section title="IPv6 ERO sub-TLV">
            <t>IPv6 ERO sub-TLV is a sub-TLV of the SID/Label Binding
            sub-TLV.</t>

            <t>The IPv6 ERO sub-TLV (Type TBA) describes a path segment using
            IPv6 Address style of encoding. Its semantics have been borrowed
            from <xref target="RFC3209"/>. <figure
                title="IPv6 ERO sub-TLV format">
                <artwork>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Type             |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Flags      |                   Reserved                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-                         IPv6 Address                        -+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>Type: TBD, suggested value 8</t>

                <t>Length: 8 bytes</t>

                <t>Flags: 1 octet field of following flags: <figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+
</artwork>
                  </figure> where: <list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>IPv6 Address - the address of the explicit route hop.</t>
              </list></t>
          </section>

          <section anchor="UNNERO" title="Unnumbered Interface ID ERO sub-TLV">
            <t>Unnumbered Interface ID ERO sub-TLV is a sub-TLV of the
            SID/Label Binding sub-TLV.</t>

            <t>The appearance and semantics of the 'Unnumbered Interface ID'
            have been borrowed from <xref target="RFC3477"/>.</t>

            <t>The Unnumbered Interface-ID ERO sub-TLV describes a path
            segment that spans over an unnumbered interface. Unnumbered
            interfaces are referenced using the interface index. Interface
            indices are assigned local to the router and therefore not unique
            within a domain. All elements in an ERO path need to be unique
            within a domain and hence need to be disambiguated using a domain
            unique Router-ID. <figure
                title="Unnumbered Interface ID ERO sub-TLV format">
                <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type            |              Length           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Flags     |                  Reserved                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Router ID                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Interface ID                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

where:</artwork>
              </figure><list style="hanging">
                <t>Type: TBD, suggested value 9</t>

                <t>Length: 12 bytes</t>

                <t>Flags: 1 octet field of following flags:<figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+

where: </artwork>
                  </figure><list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>Router-ID: Router-ID of the next-hop.</t>

                <t>Interface ID: is the identifier assigned to the link by the
                router specified by the Router-ID.</t>
              </list></t>
          </section>

          <section anchor="IPV4BERO" title="IPv4 Backup ERO sub-TLV">
            <t>IPv4 Prefix Backup ERO sub-TLV is a sub-TLV of the SID/Label
            Binding sub-TLV.</t>

            <t>The IPv4 Backup ERO sub-TLV describes a path segment using IPv4
            Address style of encoding. Its semantics have been borrowed from
            <xref target="RFC3209"/>. <figure
                title="IPv4 Backup ERO sub-TLV format">
                <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Type             |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Flags         |                     Reserved                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    IPv4 Address (4 octets)                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>Type: TBD, suggested value 10</t>

                <t>Length: 8 bytes</t>

                <t>Flags: 1 octet field of following flags: <figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+
</artwork>
                  </figure> where: <list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>IPv4 Address - the address of the explicit route hop.</t>
              </list></t>
          </section>

          <section title="IPv6 Backup ERO sub-TLV">
            <t>IPv6 ERO sub-TLV is a sub-TLV of the SID/Label Binding
            sub-TLV.</t>

            <t>The IPv6 Backup ERO sub-TLV describes a Backup path segment
            using IPv6 Address style of encoding. Its appearance and semantics
            have been borrowed from <xref target="RFC3209"/>.</t>

            <t>The 'L' bit in the Flags is a one-bit attribute. If the L bit
            is set, then the value of the attribute is 'loose.' Otherwise, the
            value of the attribute is 'strict.' <figure
                title="IPv6 Backup ERO sub-TLV format">
                <artwork>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Type             |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Flags      |                   Reserved                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-                         IPv6 Address                        -+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>Type: TBD, suggested value 11</t>

                <t>Length: 8 bytes</t>

                <t>Flags: 1 octet field of following flags: <figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+
</artwork>
                  </figure> where: <list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>IPv6 Address - the address of the explicit route hop.</t>
              </list></t>
          </section>

          <section anchor="UNNBERO"
                   title="Unnumbered Interface ID Backup ERO sub-TLV">
            <t>Unnumbered Interface ID Backup sub-TLV is a sub-TLV of the
            SID/Label Binding sub-TLV.</t>

            <t>The appearance and semantics of the 'Unnumbered Interface ID'
            have been borrowed from <xref target="RFC3477"/>.</t>

            <t>The Unnumbered Interface-ID ERO sub-TLV describes a path
            segment that spans over an unnumbered interface. Unnumbered
            interfaces are referenced using the interface index. Interface
            indices are assigned local to the router and therefore not unique
            within a domain. All elements in an ERO path need to be unique
            within a domain and hence need to be disambiguated using a domain
            unique Router-ID. <figure
                title="Unnumbered Interface ID Backup ERO sub-TLV format">
                <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Type           |             Length            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Flags    |                   Reserved                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Router ID                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Interface ID                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
              </figure> where: <list style="hanging">
                <t>Type: TBD, suggested value 12</t>

                <t>Length: 12 bytes</t>

                <t>Flags: 1 octet field of following flags: <figure
                    align="center">
                    <artwork>
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|L|             |
+-+-+-+-+-+-+-+-+
</artwork>
                  </figure> where: <list style="hanging">
                    <t>L-bit - If the L bit is set, then the value of the
                    attribute is 'loose.' Otherwise, the value of the
                    attribute is 'strict.'</t>
                  </list></t>

                <t>Router-ID: Router-ID of the next-hop.</t>

                <t>Interface ID: is the identifier assigned to the link by the
                router specified by the Router-ID.</t>
              </list></t>
          </section>
        </section>
      </section>
    </section>

    <section anchor="ADJSID" title="Adjacency Segment Identifier (Adj-SID)">
      <t>An Adjacency Segment Identifier (Adj-SID) represents a router
      adjacency in Segment Routing. At the current stage of Segment Routing
      architecture it is assumed that the Adj-SID value has local significance
      (to the router).</t>

      <section anchor="ADJSIDSUBTLV" title="Adj-SID sub-TLV">
        <t>A new extended OSPFv3 LSAs, as defined in <xref
        target="I-D.ietf-ospf-ospfv3-lsa-extend"/>, are used to advertise prefix
        SID in OSPFv3</t>

        <t>Adj-SID sub-TLV is an optional sub-TLV of the Router-Link TLV as
        defined in <xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>. It MAY appear
        multiple times in Router-Link TLV. Examples where more than one
        Adj-SID may be used per neighbor are described in <xref
        target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>. The structure
        of the Adj-SID Sub-TLV is as follows: <figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Type            |              Length           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Flags         |     Weight    |             Reserved          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   SID/Label/Index (variable)                  |
+---------------------------------------------------------------+

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 10.</t>

            <t>Length: variable.</t>

            <t>Flags. 1 octet field of following flags:<figure align="center">
                <artwork>
 0 1 2 3 4 5 6 7 
+-+-+-+-+-+-+-+-+
|B|V|L|S|       |
+-+-+-+-+-+-+-+-+

where:</artwork>
              </figure><list style="hanging">
                <t>B-Flag: Backup-flag: set if the Adj-SID refer to an
                adjacency being protected (e.g.: using IPFRR or MPLS-FRR) as
                described in <xref
                target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>.</t>

                <t>The V-Flag: Value/Index Flag. If set, then the Prefix-SID 
                carries an absolute value. If not set, then the Prefix-SID carries 
                an index.</t>
                
                <t>The L-Flag: Local/Global Flag. If set, then the value/index 
                carried by the PrefixSID has local significance. If not set, then
                the value/index carried by this subTLV has global significance.</t> 
         
                <t>The S-Flag. Set Flag. When set, the S-Flag indicates that the 
                Adj-SID refers to a set of adjacencies (and therefore MAY be assigned
                to other adjacencies as well).</t>
                
                <t>Other bits: MUST be zero when originated and ignored when
                received.</t>
              </list></t>

            <t>Weight: weight used for load-balancing purposes. The use of the
            weight is defined in <xref
            target="I-D.filsfils-rtgwg-segment-routing"/>.</t>
            
            <t>SID/Index/Label: label or index value depending on the V-bit setting.
            <list style="hanging">
            
                <t>Examples: <list style="hanging">
            
                    <t>A 32 bit global index defining the offset in the SID/Label space
                    advertised by this router - in this case the V and L flags MUST be 
                    unset.</t>
             
                    <t>A 24 bit local label where the 20 rightmost bits are used for 
                    encoding the label value - in this case the V and L flags MUST be
                    set.</t>
            
                    <t>16 octet IPv6 address - in this case the V-flag MUST be set. The 
                    L-flag MUST be set for link-local IPv6 address and MUST be unset for 
                    IPv6 global unicast address.</t>
                </list></t>
            </list></t>
            
          </list></t>

        <t>A SR capable router MAY allocate an Adj-SID for each of its
        adjacencies and set the B-Flag when the adjacency is protected by a
        FRR mechanism (IP or MPLS) as described in <xref
        target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>.</t>
      </section>

      <section anchor="LANADJSIDSUBTLV" title="LAN Adj-SID Sub-TLV">
        <t>LAN Adj-SID is an optional sub-TLV of the Router-Link TLV. It MAY
        appear multiple times in Router-Link TLV. It is used to advertise
        SID/Label for adjacency to non-DR node on broadcast or NBMA network.
        <figure>
            <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              Type             |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Flags     |     Weight    |            Reserved           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Neighbor ID                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    SID/Label/Index (variable)                 |
+---------------------------------------------------------------+

where:</artwork>
          </figure><list style="hanging">
            <t>Type: TBD, suggested value 11.</t>

            <t>Length: variable.</t>

            <t>Flags. 1 octet field of following flags:<figure align="center">
                <artwork>
 0 1 2 3 4 5 6 7 
+-+-+-+-+-+-+-+-+
|B|V|L|S|       |
+-+-+-+-+-+-+-+-+

where:</artwork>
              </figure><list style="hanging">
                <t>B-Flag: Backup-flag: set if the LAN-Adj-SID refer to an
                adjacency being protected (e.g.: using IPFRR or MPLS-FRR) as
                described in <xref
                target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>.</t>

                <t>The V-Flag: Value/Index Flag. If set, then the Prefix-SID 
                carries an absolute value. If not set, then the Prefix-SID carries 
                an index.</t>
                
                <t> The L-Flag: Local/Global Flag. If set, then the value/index 
                carried by the PrefixSID has local significance. If not set, then
                the value/index carried by this subTLV has global significance.</t> 
                
                <t>The S-Flag. Set Flag. When set, the S-Flag indicates that the 
                Adj-SID refers to a set of adjacencies (and therefore MAY be assigned
                to other adjacencies as well).</t>
                
                <t>Other bits: MUST be zero when originated and ignored when
                received.</t>
              </list></t>

            <t>Weight: weight used for load-balancing purposes. The use of the
            weight is defined in <xref
            target="I-D.filsfils-rtgwg-segment-routing"/>.</t>

            <t>SID/Index/Label: label or index value depending on the V-bit setting.
            <list style="hanging">
            
                <t>Examples: <list style="hanging">
            
                    <t>A 32 bit global index defining the offset in the SID/Label space
                    advertised by this router - in this case the V and L flags MUST be 
                    unset.</t>
             
                    <t>A 24 bit local label where the 20 rightmost bits are used for 
                    encoding the label value - in this case the V and L flags MUST be
                    set.</t>
            
                    <t>16 octet IPv6 address - in this case the V-flag MUST be set. The 
                    L-flag MUST be set for link-local IPv6 address and MUST be unset for 
                    IPv6 global unicast address.</t>
                </list></t>
            </list></t>
            
          </list></t>
      </section>
    </section>

    <section title="Elements of Procedure">
      <section title="Intra-area Segment routing in OSPFv3 ">
        <t>The OSPFv3 node that supports segment routing MAY advertise Prefix-
        SIDs for any prefix that it is advertising reachability for (e.g.
        loopback IP address) as described in <xref target="PREFIXSID"/>.</t>

        <t>If multiple routers advertise Prefix-SID for the same prefix, then
        the Prefix-SID MUST be the same. This is required in order to allow
        traffic load-balancing if multiple equal cost paths to the destination
        exist in the network.</t>

        <t>Prefix-SID can also be advertised by the SR Mapping Servers (as
        described in <xref
        target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>). The Mapping
        Server advertises Prefix-SID for remote prefixes that exist in the
        network. Multiple Mapping Servers can advertise Prefix-SID for the
        same prefix, in which case the same Prefix-SID MUST be advertised by
        all of them. SR Mapping Server could use either area scope or
        autonomous system flooding scope when advertising Prefix SID for
        prefixes, based on the configuration of the SR Mapping Server.
        Depending on the flooding scope used, SR Mapping Server chooses the
        LSA that will be used. If the area flooding scope is needed,
        E-Intra-Area-Prefix-LSA (<xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>)
        is used. If autonomous system flooding scope is needed,
        E-AS-External-LSA (<xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>) is
        used.</t>

        <t>When Prefix-SID is advertised by the Mapping Server, which is
        indicated by the M-flag in the Prefix-SID sub-TLV (<xref
        target="PREFIXSID"/>), route-type as indicated by the LSA type which
        is being used for flooding is ignored. Prefix SID is bound to a
        prefix, in which case route-type becomes unimportant.</t>

        <t>Advertisement of the Prefix-SID by the Mapping Server using
        Inter-Area Prefix TLV, External Prefix TLV or Intra-Area-Prefix TLV
        (<xref target="I-D.ietf-ospf-ospfv3-lsa-extend"/>) does not itself
        contribute to the prefix reachability. NU-bit MUST be set in the
        PrefixOptions field of the LSA which is used by the Mapping Server to
        advertise SID or SID range, which prevents such advertisement to
        contribute to the prefix reachability.</t>
      </section>

      <section title="Inter-area Segment routing in OSPFv3">
        <t>In order to support SR in a multi-area environment, OSPFv3 must
        propagate Prefix-SID information between areas. The following
        procedure is used in order to propagate Prefix SIDs between areas.</t>

        <t>When an OSPFv3 ABR advertises a Inter-Area-Prefix-LSA from an
        intra-area prefix to all its connected areas, it will also include
        Prefix-SID sub-TLV, as described in <xref target="PREFIXSID"/>. The
        Prefix-SID value will be set as follows: <list style="hanging">
            <t>The ABR will look at its best path to the prefix in the source
            area and find out the advertising router associated with its best
            path to that prefix.</t>

            <t>If no Prefix-SID was advertised for the prefix in the source
            area by the router that contributes to the best path to the
            prefix, then the ABR will use the Prefix-SID advertised by any
            other router (e.g.: a Prefix-SID coming from an SR Mapping Server
            as defined in <xref
            target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>) when
            propagating Prefix-SID for the prefix to other areas.</t>
          </list></t>

        <t>When an OSPFv3 ABR advertises Inter-Area-Prefix-LSA LSAs from an
        inter-area route to all its connected areas it will also include
        Prefix-SID sub-TLV, as described in <xref target="PREFIXSID"/>. The
        Prefix-SID value will be set as follows: <list style="hanging">
            <t>The ABR will look at its best path to the prefix in the source
            area and find out the advertising router associated with its best
            path to that prefix.</t>

            <t>The ABR will then look if such router advertised a Prefix-SID
            for the prefix and use it when advertising the Prefix-SID to other
            connected areas.</t>

            <t>If no Prefix-SID was advertised for the prefix in the source
            area by the ABR that contributes to the best path to the prefix,
            the originating ABR will use the Prefix-SID advertised by any
            other router (e.g.: a Prefix-SID coming from an SR Mapping Server
            as defined in <xref
            target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>) when
            propagating Prefix-SID for the prefix to other areas.</t>
          </list></t>
      </section>

      <section title="SID for External Prefixes">
        <t>AS-External-LSAs are flooded domain wide. When an ASBR, which
        supports SR, generates AS-External-LSA, it should also include
        Prefix-SID sub-TLV, as described in <xref target="PREFIXSID"/>
        Prefix-SID value will be set to the SID that has been reserved for
        that prefix.</t>

        <t>When a NSSA ASBR translates NSSA-LSA into AS-External-LSA, it
        should also advertise the Prefix-SID for the prefix. The NSSA ABR
        determines its best path to the prefix advertised in the translated
        NSSA-LSA and finds the advertising router associated with such path.
        If such advertising router has advertised a Prefix-SID for the prefix,
        then the NSSA ASBR uses it when advertising the Prefix-SID in
        AS-External-LSA. Otherwise the Prefix-SID advertised by any other
        router will be used (e.g.: a Prefix-SID coming from an SR Mapping
        Server as defined in <xref
        target="I-D.filsfils-rtgwg-segment-routing-use-cases"/>).</t>
      </section>

      <section title="Advertisement of Adj-SID">
        <t>The Adjacency Segment Routing Identifier (Adj-SID) is advertised
        using the Adj-SID Sub-TLV as described in <xref target="ADJSID"/>.</t>

        <section title="Advertisement of Adj-SID on Point-to-Point Links">
          <t>Adj-SID MAY be advertised for any adjacency on p2p link that is
          in a state 2-Way or higher. If the adjacency on a p2p link
          transitions from the FULL state, then the Adj-SID for that adjacency
          MAY be removed from the area. If the adjacency transitions to a
          state lower then 2-Way, then the Adj-SID MUST be removed from the
          area.</t>
        </section>

        <section title="Adjacency SID on Broadcast or NBMA Interfaces">
          <t>Broadcast or NBMA networks in OSPFv3 are represented by a star
          topology where the Designated Router (DR) is the central point all
          other routers on the broadcast or NBMA network connect to. As a
          result, routers on the broadcast or NBMA network advertise only
          their adjacency to DR and BDR. Routers that are neither DR nor BDR
          do not form and do not advertise adjacencies between them. They,
          however, maintain a 2-Way adjacency state between them.</t>

          <t>When Segment Routing is used, each router on the broadcast or
          NBMA network MAY advertise the Adj-SID for its adjacency to DR using
          Adj-SID Sub-TLV as described in <xref target="ADJSIDSUBTLV"/>.</t>

          <t>SR capable router MAY also advertise Adj-SID for other neighbors
          (e.g. BDR, DR-OTHER) on broadcast or NBMA network using the LAN
          ADJ-SID Sub-TLV as described in section 5.1.1.2. <xref
          target="LANADJSIDSUBTLV"/>.</t>
        </section>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
    
      <t>This specification updates two existing OSPF registries.</t>
      
      <section anchor="RILSAREG" title="OSPF Router Information (RI) TLVs Registry">
      
      <t>o suggested value 8 - SR-Algorithm TLV</t>

      <t>o suggested value 9 - SID/Label Range TLV</t>
      
      </section>
      
      <section anchor="EXTLSAREG" title="OSPFv3 Extend-LSA sub-TLV registry">

      <t>o suggested value 1 - SID/Label sub-TLV</t>

      <t>o suggested value 2 - Prefix SID sub-TLV</t>
      
      <t>o suggested value 3 - Adj-SID sub-TLV</t>

      <t>o suggested value 4 - LAN Adj-SID sub-TLV</t>

      <t>o suggested value 5 - SID/Label Binding sub-TLV</t>
      
      <t>o suggested value 6 - ERO Metric sub-TLV</t>

      <t>o suggested value 7 - IPv4 ERO sub-TLV</t>

      <t>o suggested value 8 - IPv6 ERO sub-TLV</t>

      <t>o suggested value 9 - Unnumbered Interface ID ERO sub-TLV</t>

      <t>o suggested value 10 - IPv4 Backup ERO sub-TLV</t>

      <t>o suggested value 11 - IPv6 Backup ERO sub-TLV</t>

      <t>o suggested value 12 - Unnumbered Interface ID Backup ERO sub-TLV</t>

      </section>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>Implementations must assure that malformed permutations of the newly
      defined sub-TLvs do not result in errors which cause hard OSPFv3
      failures.</t>
    </section>

    <section anchor="Contributors" title="Contributors">
      <t>The following people gave a substantial contribution to the content
      of this document: Ahmed Bashandy, Martin Horneffer, Bruno Decraene,
      Stephane Litkowski, Igor Milojevic, Rob Shakir and Saku Ytti.</t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>We would like to thank Anton Smirnov for his contribution.</t>

      <t>Many thanks to Yakov Rekhter, John Drake and Shraddha Hedge for their
      contribution on earlier incarnations of the "Binding / MPLS Label TLV"
      in <xref target="I-D.gredler-ospf-label-advertisement"/>.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3209.xml"?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.3477.xml"?>

      <?rfc ?>

      <?rfc ?>

      <?rfc ?>

      <?rfc include="http://xml.resource.org/public/rfc/bibxml/reference.RFC.4970.xml"?>

      <?rfc ?>

      <?rfc ?>

      <?rfc ?>
    </references>

    <references title="Informative References">
      <?rfc include="http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.draft-filsfils-rtgwg-segment-routing-01.xml"?>

      <?rfc include="http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.draft-filsfils-rtgwg-segment-routing-use-cases-02.xml"?>

      <?rfc include="http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.draft-minto-rsvp-lsp-egress-fast-protection-03.xml"?>

      <?rfc include="http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.draft-gredler-ospf-label-advertisement-03.xml"?>

      <?rfc include="http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-ospf-ospfv3-lsa-extend.xml"?>
    </references>
  </back>
</rfc>
